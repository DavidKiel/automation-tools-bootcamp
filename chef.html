<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Developer Automation Tools Bootcamp - Intro to Chef</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <a href="./index.html"><h1>Developer Automation Tools Bootcamp</h1></a>
        <h2>Learning about development tools and automation</h2>
        <a href="https://github.com/tfitch/automation-tools-bootcamp" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3><a name="introduction-to-chef" class="anchor" href="#introduction-to-chef"><span class="octicon octicon-link"></span></a>Introduction to Chef</h3>

<img src="./images/chef-logo.png" align="right" />
<p>Of all the bootcamp subjects to cover I think this one is the most impossible to present properly in one hour.  We will be able to cover the "What Chef is" but not as much about "How Chef does it".  That said, with the info here you will create a simple cookbook to configure a server.</p>

<h3><a name="chef-from-chef" class="anchor" href="#chef-from-chef"><span class="octicon octicon-link"></span></a>Chef is a product from <a href="http://www.chef.io/" target="_new">Chef</a>.</h3>

<ul>
  <li>Chef will install and configure software for your server (or VM of a server) - or even your laptop if you wanted.</li>
  <li>Chef is a DSL based on Ruby. Knowing Ruby is helpful but not required.</li>
  <li>Almost everything from <a href="https://github.com/chef" target="_new">Chef is open source</a>.  Especially the <a href="https://github.com/chef-cookbooks" target="_new">community cookbooks Chef maintains</a>.</li>
  <li>You write recipes which are stored in cookbooks.  A knife does most of the work.  LOTS of cooking related names.</li>
  <li>It is generally assumed you are using Git with Chef.  Not a requirement, but some tools in the Chef ecosystem will actually try and execute Git commands.</li>
  <li>Chef and its ecosystem of tools are advancing at a pace I've never seen in a tool.  It is *hard* to keep to up date (and it's my part of my job).</li>
  <li>Wanna learn how to do something in a Chef cookbook.  Cookbooks in the <a href="https://supermarket.chef.io" target="_new">Chef Supermarket</a> have examples of just about everything. Don't reinvent the wheel.</li>
</ul>

<h3><a name="best-practices" class="anchor" href="#best-practices"><span class="octicon octicon-link"></span></a>All the best practices of software development are available.</h3>

<p>The Ruby community are excellent at the practice of TDD (Test Driven Development).  This has, thankfully, carried over to the Chef community.  The tools exist, they increase the learning curve, but prevent bad check-ins when used properly.</p>

<ul>
  <li>Dependency management - <a href="http://berkshelf.com/" target="_new">Berkshelf</a></li>
  <li>Code linting - <a href="http://www.foodcritic.io/" target="_new">Foodcritic</a> and <a href="https://github.com/bbatsov/rubocop" target="_new">Rubocop</a></li>
  <li>Unit Testing - <a href="http://code.sethvargo.com/chefspec/" target="_new">ChefSpec</a></li>
  <li>Integration Testing - <a href="http://kitchen.ci/" target="_new">Test Kitchen</a></li>
  <li>All these tools are so useful, Chef bundled them together in to <a href="http://docs.chef.io/devkit/" target="_new">the Chef DK.</a></li>
  <li>Automation of linting, unit testing and interation testing after a code check-in can be done in in Countinuous Integration tools like <a href="./jenkins.html">Jenkins</a>, just like building other software projects</li>
  <li>Successful completion of the above steps would indicate a working cookbook change and your CI server can publish the change to the Chef server for managed machines to pull down the update and apply it.</li>
</ul>

<h3><a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting started.</h3>

<p><a href="http://learnchef.com" target="_new">LearnChef</a> has a well crafted tutorial based on your prefered client OS.  As well as numerous other webinars and tutorials.  Follow the steps as described - you'll accomplish more in an hour than you're expecting!</p>

<h3><a name="server-client" class="anchor" href="#server-client"><span class="octicon octicon-link"></span></a>Chef Server/Client</h3>
<p>The Chef Client's interactions with the Chef Server are a REST based API actually.<br />
<br />
Developing Chef cookbooks actually reminds me of old school web application development. You edit the cookbook, upload to the server and then run a Vagrant VM to pull down the change an apply, Chef calls this converging the cookbook on the client node to validate it works.  Edit, upload, provision/converge, verify results.</p>

<h3><a name="the-wheel" class="anchor" href="#the-wheel"><span class="octicon octicon-link"></span></a>Do not reinvent the wheel</h3>

<p>Now that we've covered all that - here's the secret to Chef.  <a href="https://supermarket.chef.io" target="_new">It's all been done before!!!</a>  In the same way that Java has Maven, Ruby has games or Node has npm for getting libraries people have already created - Chef has community cookbooks.  They're open source - use them *and* learn from them.<br />
<br />
Need Java?  <a href="https://supermarket.chef.io/cookbooks/java" target="_new">Use the community cookbook!</a><br />
Need Tomcat? <a href="https://supermarket.chef.io/cookbooks/tomcat" target="_new">Use the community cookbook!</a><br />
Need MongoDB? <a href="https://supermarket.chef.io/cookbooks/mongodb" target="_new">Use the community cookbook!</a><br />
<br />
For a generic base install of MongoDB from the community cookbook?  It's two lines.<br>
<pre><code># in metadata.rb file
depends 'mongodb'

# in default.rb file
include_recipe 'mongodb'
</code></pre>
DONE AND DONE.  MongoDB is installed.</p>

<h3><a name="have-to" class="anchor" href="#have-to"><span class="octicon octicon-link"></span></a>Do not reinvent the wheel (unless you have to)</h3>
<p>The community cookbooks are robust and often, but not always, support a wide range of configuration options (like host name, app install directory).<br />
<br />
BUT - sometimes (read: often) the community cookbook just isn't right.  Go ahead and roll your own.  Spin up a base Vagrant VM.  Run some commands to install your software just the way you need.  Then copy those commands in to a cookbook.  Copy any config files to your cookbook too.  Now you can reproduce your app install as many times as needed.  OR - contribute a change back to the community cookbook via a GitHub Pull Request.  <a href="http://tfitch.github.io/automation-tools-bootcamp/git-workflows.html#fork-pull-request" target="_new">We know how to do that.</a>
</p>

<h3><a name="create-cookbook" class="anchor" href="#create-cookbook"><span class="octicon octicon-link"></span></a>Create our first cookbook</h3>
<p><a href="http://docs.chef.io/devkit/getting_started.html#your-first-cookbook" target="_new">Generating your first cookbook</a> starts with the <code>chef generate cookbook automation-tools</code> command.<br />
<br />
This will give you a directory structure with all files necessary to stubbed out.  Let's just dig in to the <code>recipes/default.rb</code> file and use it to install Apache 2.
<pre><code># in recipes/default.rb
package 'apache2' do
  action :install
end
</code></pre>
You've done it.  Apache 2 has been installed.  Congrats.
</p>

<h3><a name="test-kitchen" class="anchor" href="#test-kitchen"><span class="octicon octicon-link"></span></a>Test Kitchen</h3>
<img src="./images/test_kitchen.png" align="right" width="300" />
<p>
Very good.  Now to test it.  You'll need the Chef Server, then upload the cookbook to the server, bootstrap a VM with Vagrant, register the VM with the Chef Server, and then finally converge the node to see if your cookbook works.  Sounds like a pain in the butt and it was.  With some Vagrant plugins the process was bearable, but still clunky.<br />
But <a href="https://github.com/fnichol" target="_new">Flether Nichol</a> decided we should have a better experience and instead created <a href="http://kitchen.ci/" target="_new">Test Kitchen</a>.  Similar to the joy that Mitchell Hashimoto delivered by putting VM settings in a Vagrantfile, Fletcher took Configuration Management testing to the next step and now we create .kitchen.yml files.<br />
We're just going to run <code>kitchen converge</code>.  It'll fake out a Chef server with Chef Zero (or use a real Chef server if that's your thing), spin up your desired machine with your <a href="https://rubygems.org/search?utf8=%E2%9C%93&amp;query=kitchen-" target="_new">desired driver</a> (Vagrant, Docker, AWS, OpenStack, etc), do a Chef client run of your cookbook and then test the changes (<code>kitchen test</code>) were applied or allow you to log in to the VM and check things out manually.  All of which is driven by the data in your .kitchen.yml file.
</p>

<h3><a name="to-follow" class="anchor" href="#to-follow"><span class="octicon octicon-link"></span></a>Chefs to follow on Twitter</h3>
<ul>
  <li><a href="https://twitter.com/adamhjk" target="_new">Adam Jacob</a></li>
  <li><a href="https://twitter.com/sigje" target="_new">Jennifer Davis</a></li>
  <li><a href="https://twitter.com/fnichol" target="_new">Fletcher Nichol</a></li>
  <li><a href="https://twitter.com/julian_dunn" target="_new">Julian Dunn</a></li>
  <li><a href="https://twitter.com/chef" target="_new">Chef</a></li>
</ul>
<h3><a name="podcasts" class="anchor" href="#podcasts"><span class="octicon octicon-link"></span></a>Podcasts to listen to</h3>  
<p>
  <a href="http://foodfightshow.org/" target="_new"><img src="./images/food-fight.jpeg" width="170" /> Food Fight Show</a>&nbsp;&nbsp;&nbsp;
  <a href="http://theshipshow.com" target="_new"><img src="./images/tss-logo.jpg" width="170" /> The Ship Show</a><br />
  <a href="http://www.arresteddevops.com" target="_new"><img src="./images/adoicon.png" width="170" /> Arrested DevOps</a>&nbsp;&nbsp;
  <a href="http://www.opsallthethings.com/" target="_new"><img src="./images/ops-all-the-things.jpeg" width="170" /> Ops All The Things!</a><br />
</p>

<h3><a name="workout" class="anchor" href="#workout"><span class="octicon octicon-link"></span></a>Workout</h3>

<p>We are going to complete the following actions</p>
<ol>
  <li>Review the <a href="https://github.com/tfitch/automation-tools-bootcamp/tree/master/chef/automation-tools" target="_new">example cookbook</a> which you checked out during the Git session.</li>
  <li>Edit the <code>recipes/default.rb</code> file to install Apache 2 using the <code>apache2</code> <a href="https://docs.chef.io/resource_package.html" target="_new">package</a>.</li>
  <li>Converge the node with Test Kitchen <code>kitchen converge</code></li>
  <li>Browse to the VM in your browser. <a href="http://localhost:8080" target="_new">http://localhost:8080</a>.</li>
  <li>Connect to the VM via SSH (<code><a href="http://kitchen.ci/docs/getting-started/getting-help" target="_new">kitchen ???</a></code>) and then stop the Apache server from running <code>sudo service apache2 stop</code> and reload the webpage.</li>
  <li>Feel free to move on to more Chef topics with <a href="./chef-in-practice">Chef in Practice</a></li>
</ol>



        </section>

        <aside id="sidebar">

          <p class="repo-owner">Topics<br />
            <a href="./git.html">Intro to Git</a><br />
            <a href="./git-workflows.html">Intro to Git Workflows</a><br />
            <a href="./vagrant.html">Intro to Vagrant</a><br />
            <a href="./chef.html">Intro to Chef</a><br />
            <a href="./chef-in-practice.html">Chef in Practice</a><br />
            <a href="./packer.html">Intro to Packer</a><br />
            <a href="./node-mongodb.html">Intro to Node.js and MongoDB</a><br />
            <a href="./docker.html">Intro to Docker</a><br />
            <a href="./consul.html">Intro to Consul</a><br />
            <a href="./jenkins.html">Intro to Jenkins</a><br />
            <a href="./sensu.html">Intro to Sensu</a><br />
          </p>

          <p class="repo-owner">Is maintained by <a href="http://tfitch.com/about/" target="_new">Tyler Fitch</a> (<a href="https://twitter.com/tfitch" target="_new">@tfitch</a>).</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-53342610-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>
  
  </body>
</html>